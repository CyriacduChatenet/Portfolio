import { useEffect, useRef, useState } from "react";
import Link from "next/link";
import gsap from "gsap";

import Layout from "@/components/layout";
import useFetch from "@/hooks/useFetch";
import useMenu from "@/contexts/useMenu";
import { useBodyScroll, useBodyScrollLock } from "@/hooks/useBodyScroll";
import { Data } from "@/types/data";

import styles from "@/pages/projects/style.module.scss";


const ProjectsPage = () => {
  const [projectsStateData, setProjectsStateData] = useState<Data>({});
  const [previewImageSrc, setPreviewImageSrc] = useState('');

  const previewImgRef = useRef(null);

  const handleFetchProjectsData = async () => {
    const response = await fetch("/api/projects");
    const json = await response.json();
    console.log(json);
    setProjectsStateData(json);
  };

  const handleAnimatePreview = () => {
    gsap.fromTo(previewImgRef.current, {opacity: 0}, {opacity: 100, duration:2, ease: 'power4.in'});
  };
  const handleUnanimatePreview = () => {
    gsap.fromTo(previewImgRef.current, {opacity: 100}, {opacity: 0, duration:2, ease: 'power4.out'});
  };

  useEffect(() => {
    handleFetchProjectsData();
  }, []);

  const { isOpen } = useMenu();

  useBodyScroll(isOpen);
  useBodyScrollLock(isOpen);

  return (
    <div className={styles.header}>
      <Layout
        title={"Create Next App"}
        description={"Generated by create next app"}
      >
        <div className={styles.container}>
          <div className={styles.contentTitle}>
            <h1 className={styles.title}>Projects</h1>
            <p className={styles.description}>
              Some cool projects iâ€™ve done in school or my work internship
            </p>
          </div>
          <div className={styles.content}>
            <img
              src={previewImageSrc}
              alt=""
              className={styles.projectPreview}
              ref={previewImgRef}
            />
            <ul className={styles.projectsList}>
              {projectsStateData.data?.map((project: any) => (
                <li key={project._id} className={styles.projectCard}>
                  <Link
                    href={`/project/${project.link_title}`}
                    className={styles.projectLink}
                    onMouseEnter={() => {
                      handleAnimatePreview();
                      setPreviewImageSrc(project.thumbnail);
                    }}
                    onMouseLeave={() => {
                      handleUnanimatePreview();
                      setTimeout(() => {
                        setPreviewImageSrc("");
                      },2000)
                    }}
                  >
                    {project.title}&nbsp; - &nbsp;{project.category}
                  </Link>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </Layout>
    </div>
  );
};

export default ProjectsPage;
